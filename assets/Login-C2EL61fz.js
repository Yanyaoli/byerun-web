import{g as Y,d as S,E as T,_ as A,r as y,o as L,c as N,b as m,w as g,a as C,e as F,F as R,u as M,f as P,t as z,h as G,i as W,j as V}from"./index-CZ6jN7u5.js";import{i as E,A as K,B as Z,D as Q,a as X,M as j,S as ee}from"./request-PAA82owp.js";import{a as b}from"./address-w6vdAG-M.js";var O={exports:{}},H={exports:{}};(function(){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i={rotl:function(l,u){return l<<u|l>>>32-u},rotr:function(l,u){return l<<32-u|l>>>u},endian:function(l){if(l.constructor==Number)return i.rotl(l,8)&16711935|i.rotl(l,24)&4278255360;for(var u=0;u<l.length;u++)l[u]=i.endian(l[u]);return l},randomBytes:function(l){for(var u=[];l>0;l--)u.push(Math.floor(Math.random()*256));return u},bytesToWords:function(l){for(var u=[],c=0,a=0;c<l.length;c++,a+=8)u[a>>>5]|=l[c]<<24-a%32;return u},wordsToBytes:function(l){for(var u=[],c=0;c<l.length*32;c+=8)u.push(l[c>>>5]>>>24-c%32&255);return u},bytesToHex:function(l){for(var u=[],c=0;c<l.length;c++)u.push((l[c]>>>4).toString(16)),u.push((l[c]&15).toString(16));return u.join("")},hexToBytes:function(l){for(var u=[],c=0;c<l.length;c+=2)u.push(parseInt(l.substr(c,2),16));return u},bytesToBase64:function(l){for(var u=[],c=0;c<l.length;c+=3)for(var a=l[c]<<16|l[c+1]<<8|l[c+2],f=0;f<4;f++)c*8+f*6<=l.length*8?u.push(d.charAt(a>>>6*(3-f)&63)):u.push("=");return u.join("")},base64ToBytes:function(l){l=l.replace(/[^A-Z0-9+\/]/ig,"");for(var u=[],c=0,a=0;c<l.length;a=++c%4)a!=0&&u.push((d.indexOf(l.charAt(c-1))&Math.pow(2,-2*a+8)-1)<<a*2|d.indexOf(l.charAt(c))>>>6-a*2);return u}};H.exports=i})();var te=H.exports,D={utf8:{stringToBytes:function(d){return D.bin.stringToBytes(unescape(encodeURIComponent(d)))},bytesToString:function(d){return decodeURIComponent(escape(D.bin.bytesToString(d)))}},bin:{stringToBytes:function(d){for(var i=[],l=0;l<d.length;l++)i.push(d.charCodeAt(l)&255);return i},bytesToString:function(d){for(var i=[],l=0;l<d.length;l++)i.push(String.fromCharCode(d[l]));return i.join("")}}},$=D;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var oe=function(d){return d!=null&&(U(d)||re(d)||!!d._isBuffer)};function U(d){return!!d.constructor&&typeof d.constructor.isBuffer=="function"&&d.constructor.isBuffer(d)}function re(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&U(d.slice(0,0))}(function(){var d=te,i=$.utf8,l=oe,u=$.bin,c=function(a,f){a.constructor==String?f&&f.encoding==="binary"?a=u.stringToBytes(a):a=i.stringToBytes(a):l(a)?a=Array.prototype.slice.call(a,0):!Array.isArray(a)&&a.constructor!==Uint8Array&&(a=a.toString());for(var n=d.bytesToWords(a),v=a.length*8,r=1732584193,t=-271733879,e=-1732584194,o=271733878,s=0;s<n.length;s++)n[s]=(n[s]<<8|n[s]>>>24)&16711935|(n[s]<<24|n[s]>>>8)&4278255360;n[v>>>5]|=128<<v%32,n[(v+64>>>9<<4)+14]=v;for(var p=c._ff,h=c._gg,_=c._hh,w=c._ii,s=0;s<n.length;s+=16){var k=r,x=t,I=e,B=o;r=p(r,t,e,o,n[s+0],7,-680876936),o=p(o,r,t,e,n[s+1],12,-389564586),e=p(e,o,r,t,n[s+2],17,606105819),t=p(t,e,o,r,n[s+3],22,-1044525330),r=p(r,t,e,o,n[s+4],7,-176418897),o=p(o,r,t,e,n[s+5],12,1200080426),e=p(e,o,r,t,n[s+6],17,-1473231341),t=p(t,e,o,r,n[s+7],22,-45705983),r=p(r,t,e,o,n[s+8],7,1770035416),o=p(o,r,t,e,n[s+9],12,-1958414417),e=p(e,o,r,t,n[s+10],17,-42063),t=p(t,e,o,r,n[s+11],22,-1990404162),r=p(r,t,e,o,n[s+12],7,1804603682),o=p(o,r,t,e,n[s+13],12,-40341101),e=p(e,o,r,t,n[s+14],17,-1502002290),t=p(t,e,o,r,n[s+15],22,1236535329),r=h(r,t,e,o,n[s+1],5,-165796510),o=h(o,r,t,e,n[s+6],9,-1069501632),e=h(e,o,r,t,n[s+11],14,643717713),t=h(t,e,o,r,n[s+0],20,-373897302),r=h(r,t,e,o,n[s+5],5,-701558691),o=h(o,r,t,e,n[s+10],9,38016083),e=h(e,o,r,t,n[s+15],14,-660478335),t=h(t,e,o,r,n[s+4],20,-405537848),r=h(r,t,e,o,n[s+9],5,568446438),o=h(o,r,t,e,n[s+14],9,-1019803690),e=h(e,o,r,t,n[s+3],14,-187363961),t=h(t,e,o,r,n[s+8],20,1163531501),r=h(r,t,e,o,n[s+13],5,-1444681467),o=h(o,r,t,e,n[s+2],9,-51403784),e=h(e,o,r,t,n[s+7],14,1735328473),t=h(t,e,o,r,n[s+12],20,-1926607734),r=_(r,t,e,o,n[s+5],4,-378558),o=_(o,r,t,e,n[s+8],11,-2022574463),e=_(e,o,r,t,n[s+11],16,1839030562),t=_(t,e,o,r,n[s+14],23,-35309556),r=_(r,t,e,o,n[s+1],4,-1530992060),o=_(o,r,t,e,n[s+4],11,1272893353),e=_(e,o,r,t,n[s+7],16,-155497632),t=_(t,e,o,r,n[s+10],23,-1094730640),r=_(r,t,e,o,n[s+13],4,681279174),o=_(o,r,t,e,n[s+0],11,-358537222),e=_(e,o,r,t,n[s+3],16,-722521979),t=_(t,e,o,r,n[s+6],23,76029189),r=_(r,t,e,o,n[s+9],4,-640364487),o=_(o,r,t,e,n[s+12],11,-421815835),e=_(e,o,r,t,n[s+15],16,530742520),t=_(t,e,o,r,n[s+2],23,-995338651),r=w(r,t,e,o,n[s+0],6,-198630844),o=w(o,r,t,e,n[s+7],10,1126891415),e=w(e,o,r,t,n[s+14],15,-1416354905),t=w(t,e,o,r,n[s+5],21,-57434055),r=w(r,t,e,o,n[s+12],6,1700485571),o=w(o,r,t,e,n[s+3],10,-1894986606),e=w(e,o,r,t,n[s+10],15,-1051523),t=w(t,e,o,r,n[s+1],21,-2054922799),r=w(r,t,e,o,n[s+8],6,1873313359),o=w(o,r,t,e,n[s+15],10,-30611744),e=w(e,o,r,t,n[s+6],15,-1560198380),t=w(t,e,o,r,n[s+13],21,1309151649),r=w(r,t,e,o,n[s+4],6,-145523070),o=w(o,r,t,e,n[s+11],10,-1120210379),e=w(e,o,r,t,n[s+2],15,718787259),t=w(t,e,o,r,n[s+9],21,-343485551),r=r+k>>>0,t=t+x>>>0,e=e+I>>>0,o=o+B>>>0}return d.endian([r,t,e,o])};c._ff=function(a,f,n,v,r,t,e){var o=a+(f&n|~f&v)+(r>>>0)+e;return(o<<t|o>>>32-t)+f},c._gg=function(a,f,n,v,r,t,e){var o=a+(f&v|n&~v)+(r>>>0)+e;return(o<<t|o>>>32-t)+f},c._hh=function(a,f,n,v,r,t,e){var o=a+(f^n^v)+(r>>>0)+e;return(o<<t|o>>>32-t)+f},c._ii=function(a,f,n,v,r,t,e){var o=a+(n^(f|~v))+(r>>>0)+e;return(o<<t|o>>>32-t)+f},c._blocksize=16,c._digestsize=16,O.exports=function(a,f){if(a==null)throw new Error("Illegal argument "+a);var n=d.wordsToBytes(c(a,f));return f&&f.asBytes?n:f&&f.asString?u.bytesToString(n):d.bytesToHex(n)}})();var ne=O.exports;const se=Y(ne),q=d=>se(d).toLowerCase(),le=(d,i)=>{const l=q(i),u={appVersion:K,brand:Z,deviceToken:Q,deviceType:X,mobileType:j,password:l,sysVersion:ee,userPhone:d};return E.post(b.login,u)},ae=d=>E.get(b.sendSms,{params:{phoneNum:d}}),ue=(d,i,l)=>{const u=q(i),c={password:u,passwordRes:u,userPhone:d,code:l};return E.post(b.updatePassword,c)};function J(){const d=S(!1),i=S(!1);return{LoginLoading:d,isLoggedIn:i,fetchLogin:async(c,a)=>{d.value=!0;try{const f=await le(c,a);if(f.data.code===1e4){const n=JSON.parse(localStorage.getItem("accounts")||"[]");n.push({phone:c,password:a}),localStorage.setItem("accounts",JSON.stringify(n));const v=f.data.response.oauthToken.token,r=f.data.response;return localStorage.setItem("token",v),localStorage.setItem("userData",JSON.stringify(r)),T.success("登录成功"),i.value=!0,!0}else return T.error("登录失败: "+f.data.msg),!1}catch(f){return T.error("登录失败: "+f.message),!1}finally{d.value=!1}},LoginState:()=>{const c=localStorage.getItem("token"),a=localStorage.getItem("userData"),f=a?JSON.parse(a):null;return!(!c||!f)}}}function ie(){const d=S(!1),i=S("获取验证码"),l=S(!1),u=(a,f,n)=>{let v=a;const r=setInterval(()=>{v<=0?(clearInterval(r),n()):(v-=1,f(v))},1e3)};return{SmsLoading:d,codeText:i,codeDisabled:l,fetchSendSMS:async a=>{d.value=!0,i.value="正在发送";try{const f=await ae(a);f.data.code===1e4?T.success("验证码发送成功"):T.error("验证码发送失败: "+f.data.msg)}catch(f){T.error("验证码发送出错"+f.message),i.value="获取验证码",l.value=!1}finally{d.value=!1,u(60,f=>{i.value=`${f} 秒后重新获取`,l.value=!0},()=>{i.value="获取验证码",l.value=!1})}}}}function ce(){const d=S(!1);return{ResetLoading:d,fetchResetPassword:async(l,u,c)=>{d.value=!0;try{const a=await ue(l,u,c);return a.data.code===1e4?(T.success("密码重置成功"),!0):(T.error("密码重置失败: "+a.data.msg),!1)}catch(a){return console.error("密码重置出错: "+a.message),!1}finally{d.value=!1}}}}const de={};function fe(d,i){const l=y("el-header"),u=y("el-text"),c=y("el-space"),a=y("el-button"),f=y("el-form"),n=y("el-main");return L(),N(R,null,[m(l,null,{default:g(()=>i[1]||(i[1]=[C("h1",null,"Byerun",-1)])),_:1}),m(n,null,{default:g(()=>[m(f,{class:"DisclaimerForm"},{default:g(()=>[m(c,{direction:"vertical"},{default:g(()=>[m(u,null,{default:g(()=>i[2]||(i[2]=[F("本项目仅供学习研究使用，不得用于任何商业目的或非法用途，如需体验完整功能，请使用官方App。")])),_:1}),m(u,null,{default:g(()=>i[3]||(i[3]=[F("因使用本项目而造成的任何性质的直接、间接风险损害，由使用者自行承担，开发者对于使用者的违法行为不承担任何责任。 ")])),_:1})]),_:1}),m(a,{type:"primary",onClick:i[0]||(i[0]=v=>d.$emit("closeDisclaimer"))},{default:g(()=>i[4]||(i[4]=[F("返回登录")])),_:1})]),_:1})]),_:1})],64)}const pe=A(de,[["render",fe],["__scopeId","data-v-03318ef0"]]),me={class:"disclaimer-container"},ge={class:"footer-links"},ve={__name:"LoginForm",setup(d){const i=M(),l=S({phone:"",password:""}),u=S(null),{LoginLoading:c,fetchLogin:a}=J(),f={phone:[{required:!0,message:"请输入正确的手机号码",trigger:"blur"},{validator:(t,e,o)=>{/^1\d{10}$/.test(e)===!1?o(new Error("手机号格式错误")):o()},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},n=t=>/^1[3-9]\d{9}$/.test(t)?!0:(T.error("请输入正确的手机号"),!1),v=()=>{u.value&&u.value.validate(async t=>{if(t)n(l.value.phone)&&await a(l.value.phone,l.value.password)&&i.push("/dashboard");else return console.log("error submit!!"),!1})},r=()=>{i.push("/")};return(t,e)=>{const o=y("el-header"),s=y("el-input"),p=y("el-form-item"),h=y("el-button"),_=y("el-link"),w=y("el-form"),k=y("el-main");return L(),N(R,null,[m(o,null,{default:g(()=>e[4]||(e[4]=[C("h1",null,"Byerun",-1)])),_:1}),m(k,null,{default:g(()=>[m(w,{model:l.value,rules:f,ref_key:"loginFormRef",ref:u},{default:g(()=>[m(p,{prop:"phone"},{default:g(()=>[m(s,{modelValue:l.value.phone,"onUpdate:modelValue":e[0]||(e[0]=x=>l.value.phone=x),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),m(p,{prop:"password"},{default:g(()=>[m(s,{modelValue:l.value.password,"onUpdate:modelValue":e[1]||(e[1]=x=>l.value.password=x),type:"password",placeholder:"请输入密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),m(p,null,{default:g(()=>[m(h,{type:"primary",onClick:v,loading:P(c)},{default:g(()=>e[5]||(e[5]=[F("立即登录")])),_:1},8,["loading"])]),_:1}),C("div",me,[m(_,{type:"text",underline:!1,onClick:e[2]||(e[2]=x=>t.$emit("showDisclaimer")),class:"disclaimer-link"},{default:g(()=>e[6]||(e[6]=[F(" 选择登录表示您已阅读并同意"),C("span",{class:"disclaimer-text"},"免责声明",-1)])),_:1})]),C("div",ge,[m(_,{type:"default",underline:!1,onClick:r},{default:g(()=>e[7]||(e[7]=[F("返回主页")])),_:1}),m(_,{type:"primary",underline:!1,onClick:e[3]||(e[3]=x=>t.$emit("showResetPassword"))},{default:g(()=>e[8]||(e[8]=[F("忘记密码")])),_:1})])]),_:1},8,["model"])]),_:1})],64)}}},_e=A(ve,[["__scopeId","data-v-3a14ac26"]]),he={__name:"ResetPasswordForm",setup(d){const i=S({phoneNum:"",newPassword:"",smsCode:""}),l=S(null),{SmsLoading:u,codeText:c,codeDisabled:a,fetchSendSMS:f}=ie(),{ResetLoading:n,fetchResetPassword:v}=ce(),r={phoneNum:[{required:!0,message:"请输入正确的手机号码",trigger:"blur"},{validator:(s,p,h)=>{/^1\d{10}$/.test(p)===!1?h(new Error("手机号格式错误")):h()},trigger:"blur"}],smsCode:[{required:!0,message:"请输入验证码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}]},t=s=>/^1[3-9]\d{9}$/.test(s)?!0:(T.error("请输入正确的手机号"),!1),e=()=>{l.value&&l.value.validateField("phoneNum",s=>{if(s)t(i.value.phoneNum)&&f(i.value.phoneNum);else return console.log("error submit!!"),!1})},o=async()=>{l.value&&l.value.validate(async s=>{if(s)t(i.value.phoneNum)&&await v(i.value.phoneNum,i.value.newPassword,i.value.smsCode)&&(i.value.phoneNum="",i.value.newPassword="",i.value.smsCode="");else return console.log("error submit!!"),!1})};return(s,p)=>{const h=y("el-header"),_=y("el-input"),w=y("el-button"),k=y("el-form-item"),x=y("el-form"),I=y("el-main");return L(),N(R,null,[m(h,null,{default:g(()=>p[4]||(p[4]=[C("h1",null,"Byerun",-1)])),_:1}),m(I,null,{default:g(()=>[m(x,{model:i.value,rules:r,ref_key:"resetFormRef",ref:l},{default:g(()=>[m(k,{prop:"phoneNum"},{default:g(()=>[m(_,{modelValue:i.value.phoneNum,"onUpdate:modelValue":p[0]||(p[0]=B=>i.value.phoneNum=B),placeholder:"请输入手机号",class:"phone-input",clearable:""},null,8,["modelValue"]),m(w,{type:"primary",onClick:e,disabled:P(a),loading:P(u),block:"",class:"sms-button"},{default:g(()=>[F(z(P(c)),1)]),_:1},8,["disabled","loading"])]),_:1}),m(k,{prop:"smsCode"},{default:g(()=>[m(_,{modelValue:i.value.smsCode,"onUpdate:modelValue":p[1]||(p[1]=B=>i.value.smsCode=B),placeholder:"请输入验证码",clearable:""},null,8,["modelValue"])]),_:1}),m(k,{prop:"newPassword"},{default:g(()=>[m(_,{modelValue:i.value.newPassword,"onUpdate:modelValue":p[2]||(p[2]=B=>i.value.newPassword=B),type:"password",placeholder:"请输入新密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),m(k,null,{default:g(()=>[m(w,{type:"primary",onClick:o,loading:P(n)},{default:g(()=>p[5]||(p[5]=[F("提交")])),_:1},8,["loading"])]),_:1}),m(w,{type:"text",onClick:p[3]||(p[3]=B=>s.$emit("backToLogin"))},{default:g(()=>p[6]||(p[6]=[F("返回登录")])),_:1})]),_:1},8,["model"])]),_:1})],64)}}},Fe={__name:"Login",setup(d){const i=M(),l=S(!0),u=S(!1),{isLoggedIn:c,LoginState:a}=J(),f=()=>{l.value=!1,u.value=!0},n=()=>{l.value=!0,u.value=!1},v=()=>{l.value=!1,u.value=!1},r=()=>{l.value=!0,u.value=!1},t=()=>{i.push("/dashboard")};return G(()=>{c.value&&t()}),W(async()=>{await a()&&t()}),(e,o)=>{const s=y("el-container");return L(),V(s,null,{default:g(()=>[u.value?(L(),V(pe,{key:0,onCloseDisclaimer:n})):l.value?(L(),V(_e,{key:1,onShowDisclaimer:f,onShowResetPassword:v})):(L(),V(he,{key:2,onBackToLogin:r}))]),_:1})}}};export{Fe as default};
