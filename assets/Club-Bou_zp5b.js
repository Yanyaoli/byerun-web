import{d as m,E as f,z as F,j as ne,e as _,w as t,u as oe,r as o,o as d,b as s,c as I,p as q,F as z,f as i,h as re,t as p,m as ue,a as h}from"./index-C8NV8vGo.js";import{i as j}from"./request-CtygJrjG.js";import{a as N}from"./address-w6vdAG-M.js";const ie=e=>j.get(N.weeklyClub,{params:{pageNo:1,pageSize:15,weekDay:e}}),ce=()=>j.get(N.clubTask),de=e=>j.get(N.clubHistory,{params:{pageNo:1,pageSize:15,studentId:e}}),fe=(e,y)=>j.get(N.joinClub,{params:{configurationId:e,type:y}});function pe(){const e=m([]);return{clubTask:e,fetchClubTask:async()=>{e.value=[];try{const r=await ce();r.data.code===1e4?r.data.response.length===0?e.value=[]:e.value=r.data.response.map(n=>({...n,joinStatus:3})):(f.error(r.data.msg),e.value=[])}catch(r){f.error("获取俱乐部任务信息出错: "+r.message),e.value=[]}}}}function me(){const e=m([]);return{ClubHistory:e,fetchClubHistory:async r=>{e.value=[];try{const n=await de(r);n.data.code===1e4?n.data.response.length===0?e.value=[]:e.value=n.data.response.map(c=>({...c,joinStatus:c.joinStatus!==void 0?c.joinStatus:4})):(f.error(n.data.msg),e.value=[])}catch(n){f.error("获取俱乐部历史信息出错: "+n.message)}}}}function _e(){const e=m([]);return{weeklyClubs:e,fetchWeeklyClub:async r=>{e.value=[];try{const n=await ie(r);n.data.code===1e4?e.value=n.data.response.length===0?[]:n.data.response:(f.error(n.data.msg),e.value=[])}catch(n){f.error("获取俱乐部信息出错: "+n.message),e.value=[]}}}}function ye(){const e=m(!1);return{JoinLoading:e,fetchJoinClub:async(r,n)=>{e.value=!0;try{const c=await fe(r,n);return c.data.code===1e4?(f.success(c.data.response.message),!0):(f.error(c.data.msg),!1)}catch(c){return f.error("俱乐部加入失败"+c.message),!1}finally{e.value=!1}}}}const be={class:"cell-item"},ve={class:"cell-item"},ge={class:"cell-item"},ke={class:"cell-item"},Ce={class:"cell-item"},Ne={__name:"Club",setup(e){const{clubTask:y,fetchClubTask:r}=pe(),{ClubHistory:n,fetchClubHistory:c}=me(),{weeklyClubs:E,fetchWeeklyClub:M}=_e(),{JoinLoading:S,fetchJoinClub:U}=ye(),x=m(JSON.parse(localStorage.getItem("userData"))||null),v=m([]),g=m(!1),O=oe(),H=m("1"),R=m([{id:1,label:"周一"},{id:2,label:"周二"},{id:3,label:"周三"},{id:4,label:"周四"},{id:5,label:"周五"},{id:6,label:"我的俱乐部"}]),$=F({0:"返回",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"我的俱乐部"}),w=F({0:{type:"primary",label:"报名",disabled:!1},1:{type:"danger",label:"取消报名",disabled:!1},2:{type:"warning",label:"报名",disabled:!1},3:{type:"success",label:"活动进行中",disabled:!1},4:{type:"info",label:"活动已失效",disabled:!0}}),k={large:"8px",default:"6px",small:"4px"},J=()=>{window.history.go(-1)},A=u=>{if(u==="0"){J();return}u==="6"?L():V(u)},V=async u=>{g.value=!0,await M(u),g.value=!1,v.value=E.value},L=async()=>{g.value=!0;const u=x.value.studentId;await c(u),await r(),g.value=!1,v.value=[...y.value,...n.value],v.value.length===0&&f.success("暂无需要参加的俱乐部活动")},G=async u=>{S.value=!0;let l;if(u.joinStatus===0||u.joinStatus===2)l=1;else if(u.joinStatus===1||u.joinStatus===3)l=2;else{S.value=!1;return}const T=await U(u.configurationId,l);S.value=!1,T||L()};return ne(()=>{x.value?V(1):O.push("/home")}),(u,l)=>{const T=o("el-option"),K=o("el-select"),P=o("el-header"),Q=o("Loading"),b=o("el-icon"),W=o("el-result"),B=o("el-main"),D=o("el-button"),X=o("User"),C=o("el-descriptions-item"),Y=o("Checked"),Z=o("clock"),ee=o("location"),te=o("InfoFilled"),le=o("el-descriptions"),ae=o("el-scrollbar"),se=o("el-container");return d(),_(se,null,{default:t(()=>[s(P,null,{default:t(()=>[s(K,{modelValue:H.value,"onUpdate:modelValue":l[0]||(l[0]=a=>H.value=a),placeholder:"选择时间",onChange:A,class:"week-menu"},{default:t(()=>[(d(!0),I(z,null,q(R.value,a=>(d(),_(T,{key:a.id,label:a.label,value:a.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),g.value?(d(),_(B,{key:0},{default:t(()=>[s(W,null,{"sub-title":t(()=>[s(b,{class:"is-loading"},{default:t(()=>[s(Q)]),_:1})]),extra:t(()=>l[1]||(l[1]=[])),_:1})]),_:1})):(d(),_(B,{key:1},{default:t(()=>[v.value.length>0?(d(),_(ae,{key:0,height:"70vh"},{default:t(()=>[(d(!0),I(z,null,q(v.value,a=>(d(),I("div",{key:a.configurationId},[(d(),_(le,{class:"margin-top",title:a.activityName,key:a.configurationId,column:1,border:""},{extra:t(()=>[w[a.joinStatus]?(d(),_(D,{key:0,loading:re(S),type:w[a.joinStatus].type,onClick:he=>G(a),disabled:w[a.joinStatus].disabled},{default:t(()=>[i(p(w[a.joinStatus].label),1)]),_:2},1032,["loading","type","onClick","disabled"])):ue("",!0)]),default:t(()=>[s(C,null,{label:t(()=>[h("div",be,[s(b,{style:k},{default:t(()=>[s(X)]),_:1}),l[2]||(l[2]=i(" 教师 "))])]),default:t(()=>[i(" "+p(a.teacherName),1)]),_:2},1024),s(C,null,{label:t(()=>[h("div",ve,[s(b,{style:k},{default:t(()=>[s(Y)]),_:1}),l[3]||(l[3]=i(" 人数 "))])]),default:t(()=>[i(" "+p(a.joinStudentNum)+" / "+p(a.studentNum)+"人 ",1)]),_:2},1024),s(C,null,{label:t(()=>[h("div",ge,[s(b,{style:k},{default:t(()=>[s(Z)]),_:1}),l[4]||(l[4]=i(" 时间 "))])]),default:t(()=>[i(" 周"+p($[a.weekDay])+" "+p(a.startTime)+" - "+p(a.endTime),1)]),_:2},1024),s(C,null,{label:t(()=>[h("div",ke,[s(b,{style:k},{default:t(()=>[s(ee)]),_:1}),l[5]||(l[5]=i(" 地点 "))])]),default:t(()=>[i(" "+p(a.addressDetail),1)]),_:2},1024),s(C,null,{label:t(()=>[h("div",Ce,[s(b,{style:k},{default:t(()=>[s(te)]),_:1}),l[6]||(l[6]=i(" 介绍 "))])]),default:t(()=>[i(" "+p(a.clubIntroduction),1)]),_:2},1024)]),_:2},1032,["title"]))]))),128))]),_:1})):(d(),_(W,{key:1,icon:"success","sub-title":"暂无俱乐部活动或俱乐部活动已达标"},{extra:t(()=>l[7]||(l[7]=[])),_:1}))]),_:1})),s(D,{onClick:J},{default:t(()=>l[8]||(l[8]=[i("返回")])),_:1})]),_:1})}}};export{Ne as default};
